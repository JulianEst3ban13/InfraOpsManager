<VirtualHost *:80>
    ServerName mantenimiento.loc
    ServerAlias www.mantenimiento.loc
    
    # Logs
    ErrorLog ${APACHE_LOG_DIR}/mantenimiento-error.log
    CustomLog ${APACHE_LOG_DIR}/mantenimiento-access.log combined
    
    # Directorio raíz de los archivos estáticos (opcional)
    DocumentRoot /var/www/mantenimiento
    
    # Proxy HTTP para la API
    ProxyRequests Off
    ProxyPreserveHost On
    
    # Configuración del proxy para la API
    <Location /api>
        ProxyPass http://localhost:3001/api
        ProxyPassReverse http://localhost:3001/api
    </Location>
    
    # Configuración del proxy para Socket.IO (opcional si usas Socket.IO)
    <Location /socket.io>
        ProxyPass http://localhost:3001/socket.io
        ProxyPassReverse http://localhost:3001/socket.io
        
        # Configuración para WebSockets
        RewriteEngine On
        RewriteCond %{HTTP:Upgrade} =websocket [NC]
        RewriteRule /(.*)  ws://localhost:3001/$1 [P,L]
    </Location>
    
    # Para cualquier otra ruta, servimos el index.html del frontend
    <Directory /var/www/mantenimiento>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Si una ruta no existe, servir index.html para que el router del frontend maneje la ruta
        FallbackResource /index.html
    </Directory>
</VirtualHost>

# Si necesitas HTTPS, puedes agregar este bloque adicional:
# <VirtualHost *:443>
#     ServerName mantenimiento.loc
#     ServerAlias www.mantenimiento.loc
#     
#     # Certificados SSL
#     SSLEngine on
#     SSLCertificateFile /etc/letsencrypt/live/mantenimiento.loc/fullchain.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/mantenimiento.loc/privkey.pem
#     
#     # Igual configuración que el bloque anterior...
# </VirtualHost> 